<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Engine Health Monitor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #020617;
    color: #e5e7eb;
    display: flex;
    justify-content: center;
  }
  .phone {
    max-width: 420px;
    width: 100%;
    height: 100vh;
    padding: 16px;
  }
  h1 {
    text-align: center;
    color: #38bdf8;
    font-size: 22px;
    margin-bottom: 14px;
  }
  .card {
    background: #020617;
    border-radius: 14px;
    padding: 14px;
    margin-bottom: 12px;
    box-shadow: 0 0 15px rgba(56,189,248,0.15);
  }
  .card-title {
    font-size: 14px;
    color: #94a3b8;
    margin-bottom: 10px;
    text-transform: uppercase;
  }
  .row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #1e293b;
  }
  .row:last-child { border-bottom: none; }
  .label { font-size: 14px; color: #94a3b8; }
  .value { font-size: 16px; font-weight: bold; }
  .status {
    text-align: center;
    font-size: 20px;
    padding: 14px;
    border-radius: 12px;
    font-weight: bold;
  }
  .ok { background: rgba(34,197,94,0.15); color: #22c55e; }
  .fault { background: rgba(239,68,68,0.15); color: #ef4444; }
</style>
</head>

<body>
<div class="phone">

<h1>ENGINE HEALTH MONITOR</h1>

<!-- ðŸ”´ RAW SENSOR DATA -->
<div class="card">
  <div class="card-title">Live Sensor Data</div>
  <div class="row"><div class="label">AX RMS</div><div class="value" id="ax">--</div></div>
  <div class="row"><div class="label">AY RMS</div><div class="value" id="ay">--</div></div>
  <div class="row"><div class="label">AZ RMS</div><div class="value" id="az">--</div></div>
  <div class="row"><div class="label">Resultant RMS</div><div class="value" id="res">--</div></div>
  <div class="row"><div class="label">Shock Count</div><div class="value" id="shock">--</div></div>
</div>

<!-- ðŸ”µ CALCULATED VALUES -->
<div class="card">
  <div class="card-title">Calculated Parameters</div>
  <div class="row"><div class="label">Vibration Frequency</div><div class="value" id="vibFreq">-- Hz</div></div>
  <div class="row"><div class="label">Acoustic dB</div><div class="value" id="acDb">-- dB</div></div>
  <div class="row"><div class="label">Acoustic Frequency</div><div class="value" id="acFreq">-- Hz</div></div>
  <div class="row"><div class="label">Frequency Band Energy</div><div class="value" id="energy">--</div></div>
  <div class="row"><div class="label">Amplitude Mean</div><div class="value" id="amp">--</div></div>
</div>

<!-- ðŸš¦ ENGINE STATUS -->
<div class="card">
  <div id="status" class="status ok">WAITING FOR DATA</div>
</div>

</div>

<script>
  const firebaseConfig = {
    databaseURL: "https://arcontrol-fcc95-default-rtdb.firebaseio.com/"
  };
  firebase.initializeApp(firebaseConfig);
  const ref = firebase.database().ref("engine_vibration");

  ref.on("value", snap => {
    const data = snap.val();
    if (!data) return;

    const keys = Object.keys(data);
    const latest = data[keys[keys.length - 1]];

    const ax = latest.ax_rms;
    const ay = latest.ay_rms;
    const az = latest.az_rms;
    const res = latest.resultant_rms;
    const shock = latest.shock_count;

    // Display RAW
    axEl.innerText = ax.toFixed(3);
    ayEl.innerText = ay.toFixed(3);
    azEl.innerText = az.toFixed(3);
    resEl.innerText = res.toFixed(3);
    shockEl.innerText = shock;

    // Calculations
    const vibFreq = res * 1500;
    const acDb = 20 * Math.log10(res + 0.001);
    const acFreq = vibFreq * 2.5;
    const energy = res * res;
    const amp = (ax + ay + az) / 3;

    vibFreqEl.innerText = vibFreq.toFixed(1) + " Hz";
    acDbEl.innerText = acDb.toFixed(1) + " dB";
    acFreqEl.innerText = acFreq.toFixed(1) + " Hz";
    energyEl.innerText = energy.toFixed(3);
    ampEl.innerText = amp.toFixed(3);

    const status = document.getElementById("status");
    if (res > 1.2 || shock > 2) {
      status.innerText = "FAULT DETECTED";
      status.className = "status fault";
    } else {
      status.innerText = "ENGINE HEALTHY";
      status.className = "status ok";
    }
  });

  const axEl = document.getElementById("ax");
  const ayEl = document.getElementById("ay");
  const azEl = document.getElementById("az");
  const resEl = document.getElementById("res");
  const shockEl = document.getElementById("shock");

  const vibFreqEl = document.getElementById("vibFreq");
  const acDbEl = document.getElementById("acDb");
  const acFreqEl = document.getElementById("acFreq");
  const energyEl = document.getElementById("energy");
  const ampEl = document.getElementById("amp");
</script>

</body>
</html>
