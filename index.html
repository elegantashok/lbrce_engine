<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Engine Health Monitor</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body style="
  margin:0;
  background:#0e1621;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
">

<div style="
  width:360px;
  min-height:640px;
  background:#111;
  color:#fff;
  padding:15px;
  box-sizing:border-box;
">

  <!-- LOGO -->
  <div style="text-align:center;margin-bottom:10px;">
    <img src="https://www.lbrce.ac.in/images/logo.png"
         style="width:220px;max-width:90%;">
  </div>

  <h2 style="text-align:center;margin:5px 0 15px 0;">
    ENGINE HEALTH MONITOR
  </h2>

  <!-- LIVE DATA -->
  <div style="background:#1b2635;padding:10px;border-radius:8px;margin-bottom:10px;">
    <h3>Live Sensor Data</h3>
    <p>AX RMS: <span id="ax">--</span></p>
    <p>AY RMS: <span id="ay">--</span></p>
    <p>AZ RMS: <span id="az">--</span></p>
    <p>Resultant RMS: <span id="res">--</span></p>
    <p>Shock Count: <span id="shock">--</span></p>
  </div>

  <!-- CALCULATED VALUES -->
  <div style="background:#16202f;padding:10px;border-radius:8px;margin-bottom:10px;">
    <h3>Calculated Parameters</h3>
    <p>Vibration Frequency: <span id="vfreq">--</span> Hz</p>
    <p>Acoustic dB: <span id="adb">--</span> dB</p>
    <p>Acoustic Frequency: <span id="afreq">--</span> Hz</p>
    <p>Frequency Band Energy: <span id="fbe">--</span></p>
    <p>Amplitude Mean: <span id="amean">--</span></p>
  </div>

  <!-- ENGINE STATUS -->
  <div style="
    background:#0f5132;
    padding:12px;
    border-radius:8px;
    text-align:center;
    font-size:18px;
  ">
    ENGINE STATUS: <span id="status">--</span>
  </div>
 <footer>
    Real-time IoT Monitoring â€¢ PUJITH & TEAM LBRCE
  </footer>
</div>

<script>
/* ================== FIREBASE CONFIG ================== */
/* ðŸ”´ REPLACE WITH YOUR OWN VALUES */
const firebaseConfig = {
  apiKey: "AIzaSyApiGq4e2WuR3Ye_qTH9WJNRm5qxDv4s4s",
  databaseURL: "https://arcontrol-fcc95-default-rtdb.firebaseio.com"
};
/* ===================================================== */

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ðŸ”´ CHANGE PATH IF NEEDED */
const dataRef = db.ref("engine_vibration");

dataRef.limitToLast(1).on("value", snapshot => {
  snapshot.forEach(child => {
    const d = child.val();

    const ax = d.ax_rms || 0;
    const ay = d.ay_rms || 0;
    const az = d.az_rms || 0;
    const res = d.resultant_rms || 0;
    const shock = d.shock_count || 0;

    document.getElementById("ax").innerText = ax.toFixed(2);
    document.getElementById("ay").innerText = ay.toFixed(2);
    document.getElementById("az").innerText = az.toFixed(2);
    document.getElementById("res").innerText = res.toFixed(2);
    document.getElementById("shock").innerText = shock;

    /* ===== CALCULATIONS ===== */
    const vibrationFreq = res * 18;
    const acousticDb = 20 * Math.log10(res + 0.01);
    const acousticFreq = vibrationFreq * 1.2;
    const bandEnergy = res * res;
    const ampMean = (ax + ay + az) / 3;

    document.getElementById("vfreq").innerText = vibrationFreq.toFixed(1);
    document.getElementById("adb").innerText = acousticDb.toFixed(1);
    document.getElementById("afreq").innerText = acousticFreq.toFixed(1);
    document.getElementById("fbe").innerText = bandEnergy.toFixed(2);
    document.getElementById("amean").innerText = ampMean.toFixed(2);

    /* ===== ENGINE STATUS LOGIC ===== */
    let status = "NORMAL";
    let color = "#0f5132";

    if (res > 1.5 || shock > 5) {
      status = "FAULTY";
      color = "#842029";
    } else if (res > 1.0) {
      status = "NORMAL";
      color = "#664d03";
    }

    const statusBox = document.getElementById("status");
    statusBox.innerText = status;
    statusBox.parentElement.style.background = color;
  });
});
</script>

</body>
</html>
